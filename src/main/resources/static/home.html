<!DOCTYPE html>
<html>
<head>
    <title>Gestic</title>
    <link rel="icon" type="image/png" href="./img/page-icon.png"><!--href="https://cdn2.iconfinder.com/data/icons/web/512/Global_Connections-512.png"> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> -->
    <script src="./js/jquery-3.3.1.min.js"></script>
    <script src="./js/fontawesome.js"></script>
    <!--<script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script> -->
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.css"> -->
    <link rel="stylesheet" type="text/css" href="./css/bulma.css">
    <!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <style>
        input[type='text']{height:35px; width:500px;}
        input[type='password']{height:35px; width:300px;}
        th.finger { cursor: pointer; }
        label { font: normal 12px courier !important;}
    </style>
</head>

<body style="margin:20px;padding-top:20px;" class="container">

<!--
@media (min-width: 1025px) {
   .navbar-menu {display: none;}
}
@media (max-width: 1024px) {
   .tabs {display: none;}
}
<button class="button navbar-burger" data-target="navMenu">
    <span></span>
    <span></span>
    <span></span>
</button>

<div class="navbar-menu" id="navMenu">
    <a class="navbar-item" onclick="homeTabClick()">Home</a>
    <a class="navbar-item" onclick="utentiTabClick()">Utenti</a>
    <a class="navbar-item" onclick="clientiTabClick()">Anagrafica</a>
    <a class="navbar-item" onclick="scadenzeTabClick()">Scadenze</a>
    <a class="navbar-item" onclick="contattiTabClick()">Contatti</a>
</div>
-->
<a class="button is-outlined is-info" onclick="logoutClick()" style="float: right">Esci</a>
<a class="button is-white" id="mionome" onclick="utentiTabClick()" style="float:right;"></a>

<div id="tabs_processi" class="tabs">
    <ul>
        <li id="home_tab"     class="tab is-active"><a  onclick="homeTabClick()">Home</a></li>
        <li id="utenti_tab"   class="tab"><a onclick="utentiTabClick()">Utenti</a></li>
        <li id="clienti_tab"  class="tab"><a onclick="clientiTabClick()">Anagrafica</a></li>
        <li id="scadenze_tab" class="tab"><a onclick="scadenzeTabClick()">Scadenze</a></li>
        <li id="contatti_tab" class="tab"><a onclick="contattiTabClick()">Contatti</a></li>
    </ul>
</div>


<div class="box has-text-centered" id="home_div">
    <h3 class="title"><b>Gestic</b></h3>
    <h3 class="subtitle"><b>il gestionale di</b></h3>
    <img src="../img/logo_impresa_consulting.png" />
</div>

<div class="box has-text-centered" id="contatti_div">
    <p> <b>NUOVA SEDE: </b></p><br />

    <p>    VIA SALVO D'ACQUISTO 3 </p>
    <p>    70014 CONVERSANO (BA)  </p>
    <p>    CONTATTI:  080.8490902 </p>
    <p>    EMAIL: <b>   <a href="mailto:info@icnews.it" target="_top">info@icnews.it</a></b></p>

    <p>
        <a target="_blank" href="https://www.facebook.com/impresaconsulting/">
            <i class="fab fa-facebook-f fa-2x has-text-info"></i>
            SEGUICI SU FACEBOOK PER NEWS!
        </a>
    </p>


</div>


<div class="box has-text-centered" id="tabella_utenti">
    <h3 class="subtitle"><b>Utenti</b></h3>

    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>CODICE FISCALE</th>
                <td>NOMINATIVO</td>
                <td>EMAIL</td>
                <td>RUOLO</td>
            </tr>
        </thead>
        <tbody id="body_tabella_utenti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <br /><a class="button is-primary is-medium only_admin" href="#form_utente" onclick="nuovoUtente()">Nuovo Utente</a>
          <a class="button is-warning is-medium" href="#form_cambia_password_utente" onclick="cambioPassword()">Cambio Password</a>
</div>

<div class="box has-text-centered" id="tabella_clienti">

    <div class="field has-addons">
        <p style="padding-top:5px;"> Cerca in anagrafica per: &nbsp &nbsp &nbsp</p>
        <select id="cercaClientiSelect" style="height:35px;">
            <option value="nominativo">Cognome Nome</option>
            <option value="ragionesociale">Ragione sociale</option>
            <option value="attivita">Attivita'</option>
            <option value="segnalatore">Segnalatore</option>
            <option value="interessatoa">Interessato a</option>
            <option value="id">P.IVA/C.F.</option>
            <option value="tutti">Visualizza tutti</option>
        </select>
        <div class="control">
            <input id="cercaClientiInput" class="input" type="text" placeholder="Parametro di ricerca">
        </div>
        <div class="control">
            <a id="cercaClientiButton" class="button is-info" onclick="cercaClienti()">Cerca</a>
        </div>
    </div><br /><br />

    <h3 class="subtitle"><b>Anagrafica</b></h3>
    <table class="table is-striped has-text-centered" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>P.IVA/C.F.</th>
                <td>RAGIONE SOCIALE</td>
                <td>NOMINATIVO</td>
                <td>ATTIVITA'</td>
                <td>PRATICHE</td>
                <td>+SCADENZA</td>
            </tr>
        </thead>
        <tbody id="body_tabella_clienti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
                <td><td>
                <td><td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <br /><a class="button is-primary is-medium" href="#form_cliente" onclick="nuovoCliente()">Nuovo Contatto</a>
</div>

<div class="box has-text-centered" id="tabella_pratiche">
    <h3 class="subtitle"><b>Pratiche</b></h3>
    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>ID PRATICA</th>
                <td>DESCRIZIONE</td>
                <td>DATA</td>
                <td>DOCUMENTI</td>
            </tr>
        </thead>
        <tbody id="body_tabella_pratiche">
            <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <br /><a class="button is-primary is-medium" href="#form_pratica" onclick="nuovaPratica()">Nuova Pratica</a>
</div>

<div class="box has-text-centered" id="tabella_documenti">
    <h3 class="subtitle"><b>Documenti</b></h3>
    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
        <tr>
            <th>DESCRIZIONE</th>
            <td>STEP</td>
            <td>DATA</td>
        </tr>
        </thead>
        <tbody id="body_tabella_documenti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
    <br /><a class="button is-primary is-medium" href="#form_documento" onclick="nuovoDocumento()">Nuovo Documento</a>
</div>



<div class="box has-text-centered" id="tabella_scadenze">
    <h3 class="subtitle"><b>Prossime scadenze</b></h3>
    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
        <tr>
            <th>DESCRIZIONE</th>
            <td>SCADENZA</td>
            <td>CONTATTO</td>
            <td>ELIMINA</td>
        </tr>
        </thead>
        <tbody id="body_tabella_scadenze">
        <tr>
            <th></th>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        </tbody>
    </table>
    <br /><br />
    <br /><a class="button is-primary is-medium" onclick="visualizzaTutteScadenze()">Visualizza tutte le scadenze</a>
</div>


<!--  ************************************************************* -->
<div class="box" id="form_utente">
    <h3 class="subtitle has-text-centered"><b>Utente</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Codice Fiscale: </b></span><input type="text" id="codicefiscale_utente" placeholder="Codice Fiscale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Nominativo: </b></span><input type="text" id="nominativo_utente" placeholder="Nominativo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Indirizzo: </b></span><input type="text" id="indirizzo_utente" placeholder="Indirizzo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Telefono: </b></span><input type="text" id="telefono_utente" placeholder="Telefono"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>E-mail: </b></span><input type="text" id="email_utente" placeholder="E-mail"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Data di nascita: </b></span><input type="text" id="natoil_utente" placeholder="gg/mm/aaaa"><br />
    <br /><a class="button is-primary is-medium submit" onclick="submitUtente()">Submit</a>
    <a class="button is-primary is-warning is-medium hidden_form only_admin modifica" onclick="modificaClick('utente')">Modifica</a>
</div>

<div class="box" id="form_cambia_password_utente">
    <h3 class="subtitle  has-text-centered"><b>Cambia password</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Vecchia password: </b></span><input type="password" id="vecchia_password_utente" placeholder="Vecchia password"><br />

    <span style="display: inline-block;width:400px;padding-top:15px;"><b>Password: </b></span><input type="password" id="cambiapwd_password_utente" placeholder="Password"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Conferma password: </b></span><input type="password" id="cambiapwd_confermapassword_utente" placeholder="Conferma password"><br />
    <br /><a class="button is-primary is-medium submit" onclick="submitPasswordUtente()">Submit</a>
</div>

<div class="box" id="form_cliente">
    <h3 class="subtitle has-text-centered"><b>Contatto</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>P.Iva / Codice Fiscale: </b></span><input type="text" id="idcliente_cliente" placeholder="P. Iva / Codice Fiscale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Ragione sociale: </b></span><input type="text" id="ragionesociale_cliente" placeholder="Ragione sociale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Nominativo: </b></span><input type="text" id="nominativo_cliente" placeholder="Cognome Nome"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Indirizzo: </b></span><input type="text" id="indirizzo_cliente" placeholder="Indirizzo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Telefono: </b></span><input type="text" id="telefono_cliente" placeholder="Telefono"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>E-mail: </b></span><input type="text" id="email_cliente" placeholder="E-mail"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Sito: </b></span><input type="text" id="sito_cliente" placeholder="Sito"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Segnalatore: </b></span><input type="text" id="segnalatore_cliente" placeholder="Cognome Nome"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Attivita': </b></span><input type="text" id="attivita_cliente" placeholder="Attivita"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Interessato a: </b></span><input type="text" id="interessatoa_cliente" placeholder="Interessato a..."><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_cliente" placeholder="Note"><br />
    <section class="hidden_form">
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Registrato da: </b></span><input type="text" id="registratoda_cliente" placeholder="Registrato da"><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Data: </b></span><input type="text" id="data_cliente" placeholder="Data"><br />
    </section>
    <br /><a class="button is-primary is-medium submit" onclick="submitCliente()">Submit</a>
    <a class="button is-primary is-warning is-medium hidden_form  modifica" onclick="modificaClick('cliente')">Modifica</a>
</div>

<div class="box" id="form_pratica">
    <h3 id="title_form_pratica" class="subtitle  has-text-centered"><b>Pratica</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>ID Pratica: </b></span><input type="text" id="idpratica_pratica" placeholder="Id pratica"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Descrizione: </b></span><input type="text" id="descrizione_pratica" placeholder="Descrizione"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_pratica" placeholder="Note"><br />
    <section class="hidden_form">
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Data: </b></span><input type="text" id="data_pratica" placeholder="Data pratica"><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Del cliente: </b></span><label id="fkcliente_pratica"></label><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Registrato da: </b></span><input type="text" id="registratoda_pratica" placeholder="Registrato da"><br />
    </section>
    <br /><a class="button is-primary is-medium submit" onclick="submitPratica()">Submit</a>
    <a class="button is-primary is-warning is-medium hidden_form modifica" onclick="modificaClick('pratica')">Modifica</a>
</div>

<div class="box" id="form_documento">
    <h3 class="subtitle has-text-centered"><b>Documento</b></h3>

    <section class="hidden_form">
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>ID Documento: </b></span><label id="iddocumento_documento" /><br />
    </section>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Descrizione: </b></span><input type="text" id="descrizione_documento" placeholder="Descrizione"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_documento" placeholder="Note"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Step pratica: </b></span>
    <select id="stepPraticaDocumentoSelect" style="height:35px;">
        <option value="presentazione">Presentazione</option>
        <option value="ammissione">Ammissione</option>
        <option value="rendicontazione">Rendicontazione</option>
        <option value="collaudo">Collaudo</option>
    </select><br />

    <form method="POST" enctype="multipart/form-data" id="fileUploadForm">
        <input id="file_upload_cliente" type="hidden" name="cliente"/>
        <input id="file_upload_pratica" type="hidden" name="pratica"/>
        <input id="file_upload_step" type="hidden" name="step"/>
        <span style="display: inline-block;width:400px;padding-top:5px;"><input type="file" name="files" class="button is-info is-outlined"/></span>
        <input type="submit" value="Carica file" id="btnSubmit" class="button is-info is-outlined" style="margin-top:5px;"/>
    </form>
    <pre>
        <label id="result_caricamento"></label><label id="percorsofile_documento"></label>
        <a id="download_documento" class="button is-primary" href="#" target="_blank" onclick="">Download</a>
    </pre>

    <section class="hidden_form">
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Data: </b></span><input type="text" id="data_documento" placeholder="Data documento"><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Della pratica: </b></span><label id="fkpratica_documento"></label><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Registrato da: </b></span><input type="text" id="registratoda_documento" placeholder="Registrato da"><br />
    </section>
    <br /><a class="button is-primary is-medium submit" onclick="submitDocumento()">Salva dati documento</a>
    <a class="button is-primary is-warning is-medium hidden_form modifica" onclick="modificaClick('documento')">Modifica</a>
</div>



<div id="modal_nuova_scadenza" class="modal">
    <div class="modal-background"></div>
    <div class="modal-content" style="background-color:#FFFFFF; width:100%; padding:40px;">

        <h3 class="subtitle has-text-centered"><b>Crea nuova scadenza</b></h3>

        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Descrizione: </b></span><input type="text" id="descrizione_scadenza" class="always_enabled" placeholder="Descrizione"><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Scadenza: </b></span><input type="text" id="datascadenza_scadenza" class="always_enabled" placeholder="gg/mm/aaaa"><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Avviso a partire da: </b></span>
        <select id="avvisoDaSelect" style="height:35px;">
           <option value="giorno_stesso">Giorno stesso</option>
           <option value="giorno_prima">Giorno prima</option>
           <option value="cinque_giorni_prima">5 giorni prima</option>
           <option value="dieci_giorni_prima">10 giorni prima</option>
        </select><br />
        <span style="display: inline-block;width:400px;padding-top:5px;"><b>Per il contatto: </b></span>
        <label id="fkcliente_scadenza"></label>
        <br />

        <br /><a class="button is-primary is-medium" onclick="submitScadenza()">Submit</a>
    </div>

    <button class="modal-close is-large" aria-label="close" onclick="chiudiModalNuovaScadenza()"></button>

</div>


<footer class="box has-text-centered">
    <section style="font-size:10px">
    &copy; 2018 <a href="https://www.linkedin.com/in/alessandro-argentieri-92460541/">Alessandro Argentieri</a>
    e-mail: <a href="mailto:alessandroargentieri@libero.it">
        alessandroargentieri@libero.it</a>
    </section>
</footer>


<script>

        var updatingId='';
        var fkcliente='';
        var fkpratica='';

        $(document).ready(function(){
          homeTabClick();
          getMioNome();
          userOrAdmin();
          updateScadenze();
        });

        function userOrAdmin(){
            $.ajax({
            url: '/user/or/admin',
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                if(data == 'ROLE_USER'){
                    $(".only_admin").remove();
                }
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        $("#btnSubmit").click(function (event) {
             event.preventDefault();
             $("#file_upload_step").val( $("#stepPraticaDocumentoSelect").val() );
             fire_ajax_submit();
        });

        function fire_ajax_submit() {
            $("#result_caricamento").text("");
            $("#percorsofile_documento").text("");
            $("#download_documento").prop('href', '#');
            var form = $('#fileUploadForm')[0];
            var data = new FormData(form);
            $("#btnSubmit").prop("disabled", true);
            $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: "/api/upload",
                data: data,
                processData: false, //prevent jQuery from automatically transforming the data into a query string
                contentType: false,
                cache: false,
                timeout: 600000,
                success: function (data) {
                    $("#result_caricamento").text("Documento caricato: ");
                    $("#percorsofile_documento").text(data);
                    $("#download_documento").prop('href', '/getfile?filename=' + data);
                    console.log("SUCCESS : ", data);
                    $("#btnSubmit").prop("disabled", false);
                },
                error: function (e) {
                    alert(e.responseText);
                    console.log("ERROR : ", e);
                    $("#btnSubmit").prop("disabled", false);
                }
            });
        }

        function downloadClick(){
            var file = $("#percorsofile_documento").text();
            if( file == '' || file == null){
                alert("Nessun percorso file selezionato!");
            }else{
                $.ajax({
                   url: '/getfile',
                   type: "GET",
                   data: {
                     filename:  file
                   },
                   success: function (data, status, xhr) {
                      console.log(data);
                   },
                   error: function(result) {
                      alert("Errore: " + result.responseJSON.message);
                      console.log(result);
                   }
               });
            }
        }

        function showUtenti(){
           $.ajax({
            url: '/get/utente',
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_utenti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_utenti").append("<tr><th class='finger' onclick='seeUtente(\"" + val.codiceFiscale + "\", \"" + val.nominativo + "\", \"" + val.indirizzo + "\", \"" + val.telefono + "\", \"" + val.email + "\", \"" + val.natoIl + "\", \"" + val.ruolo + "\")'><a href='#form_utente'>" + val.codiceFiscale + "</a></th><td>" + val.nominativo + "</td><td class='column'>" + val.email + "</td><td>" + val.ruolo + "</td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function getMioNome(){
           $.ajax({
                url: '/get/mio/nome',
                type: "GET",
                success: function (data, status, xhr) {
                    console.log(data);
                    $("#mionome").text(data);
                },
                error: function(result) {
                    console.log(result);
                }
           });
        }

        function showScadenze(){
           $.ajax({
            url: '/get/scadenza',
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_scadenze").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_scadenze").append("<tr class='" + val.avvisoDa + "'><th>" + val.descrizione + "</th><td>" + convertDate(val.dataScadenza) + "</td><td class='finger' onclick='goToCliente(\"" + val.fkCliente + "\")'>" + val.fkCliente + "</td><td><p class='delete' onclick='deleteScadenza(" + val.idScadenza + ")'></p></td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function visualizzaTutteScadenze(){
            $.ajax({
                url: '/get/all/scadenza',
                type: "GET",
                success: function (data, status, xhr) {
                    console.log(data);
                    $("#body_tabella_scadenze").empty();
                    jQuery.each(data, function(i, val) {
                        $("#body_tabella_scadenze").append("<tr class='" + val.avvisoDa + "'><th>" + val.descrizione + "</th><td>" + convertDate(val.dataScadenza) + "</td><td class='finger' onclick='goToCliente(\"" + val.fkCliente + "\")'>" + val.fkCliente + "</td><td><p class='delete' onclick='deleteScadenza(" + val.idScadenza + ")'></p></td></tr>");
                    });
                },
                error: function(result) {
                    alert("Errore: " + result.responseJSON.error);
                    console.log(result);
                }
           });
        }

        function deleteScadenza(idScadenza){
            $.ajax({
            url: '/delete/scadenza/' + idScadenza,
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                showScadenze();
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function updateScadenze(){
            $.ajax({
                url: '/delete/old/scadenza',
                type: "GET",
                success: function (data, status, xhr) {
                    console.log(data);
                },
                error: function(result) {
                    console.log(result);
                }
           });
        }

        function goToCliente(fkCliente){
           clientiTabClick();
           showClienti('/get/cliente/id/' + fkCliente);
        }

        function cercaClienti(){
            var parametroRicerca = $("#cercaClientiInput").val();
            var tipoRicerca = $("#cercaClientiSelect").val();
            var urlComposto = '/get/cliente';
            emptyForms();
            $("#tabella_pratiche").hide();
            $("#tabella_documenti").hide();
            if(tipoRicerca == 'nominativo'){
                urlComposto = '/get/cliente/nominativo/' + parametroRicerca;
            }else if(tipoRicerca == 'ragionesociale'){
                urlComposto = '/get/cliente/ragionesociale/' + parametroRicerca;
            }else if(tipoRicerca == 'attivita'){
                urlComposto = '/get/cliente/attivita/' + parametroRicerca;
            }else if(tipoRicerca == 'segnalatore'){
                urlComposto = '/get/cliente/segnalatore/' + parametroRicerca;
            }else if(tipoRicerca == 'interessatoa'){
                urlComposto = '/get/cliente/interessatoa/' + parametroRicerca;
            }else if(tipoRicerca == 'id'){
                urlComposto = '/get/cliente/id/' + parametroRicerca;
            }
            showClienti(urlComposto);
        }

        function showClienti(urlComposto){
           $.ajax({
            url: urlComposto,
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_clienti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_clienti").append("<tr id='istanza_cliente_" + val.idCliente + "' class='generic_cliente'><th  class='finger' onclick='seeCliente(\"" + val.idCliente + "\", \"" + val.ragioneSociale + "\", \"" + val.nominativo + "\", \"" + val.indirizzo + "\", \"" + val.telefono + "\", \"" + val.email + "\", \"" + val.sito + "\", \"" + val.segnalatore + "\", \"" + val.attivita + "\", \"" + val.interessatoA + "\", \"" + val.registratoDa + "\", \"" + val.data + "\", \"" + val.note + "\")'><a href='#form_cliente'>" + val.idCliente + "</a></th><td>" + val.ragioneSociale + "</td><td>" + val.nominativo + "</td><td>" + val.attivita + "</td><td class='finger' style='text-align: center;'><i class='fa fa-folder fa-2x has-text-info' onclick='showPratiche(\"" + val.idCliente + "\")'></i></td><td class='finger' style='text-align: center;'><i class='far fa-calendar-alt fa-2x has-text-warning' onclick='nuovaScadenza(\"" + val.idCliente + "\")'></i></td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function showPratiche(idCliente){
           emptyForms();
           $("#istanza_cliente_" + idCliente).removeClass("generic_cliente");
           $(".generic_cliente").empty();
           $("#tabella_pratiche").show();
           fkcliente=idCliente;
           $("#file_upload_cliente").val(fkcliente);
           $.ajax({
            url: '/get/pratica/cliente/' + idCliente,
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_pratiche").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_pratiche").append("<tr id='istanza_pratica_" + i + "' class='generic_pratica'><th  class='finger' onclick='seePratica(\"" + val.idPratica + "\", \"" + val.descrizione + "\", \"" + val.note + "\", \"" + val.data +"\", \"" + val.fkCliente + "\", \"" + val.registratoDa + "\")'><a href='#form_pratica'>" + val.idPratica + "</a></th><td>" + val.descrizione + "</td><td>" + convertDate(val.data) + "</td><td  class='finger' style='text-align: center;'><i class='fa fa-folder fa-2x has-text-success' onclick='showDocumenti(\"" + val.idPratica + "\", \"" + i + "\")'> </i></td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function showDocumenti(idPratica, i){
           emptyForms();
           $("#istanza_pratica_" + i).removeClass("generic_pratica");
           $(".generic_pratica").empty();
           $("#tabella_documenti").show();
           fkpratica=idPratica;
           $("#file_upload_pratica").val(fkpratica);
           $.ajax({
            url: '/get/documento/pratica/' + idPratica,
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_documenti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_documenti").append("<tr><th  class='finger' onclick='seeDocumento(\"" + val.idDocumento + "\", \"" + val.descrizione + "\", \"" + val.percorsoFile + "\", \"" + val.note + "\", \"" + val.stepPratica + "\", \"" + val.fkPratica + "\", \"" + val.registratoDa + "\", \"" + val.data + "\")'><a href='#form_documento'>" + val.descrizione + "</a></th><td>" + val.stepPratica + "</td><td>" + convertDate(val.data) + "</td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result.responseJSON.error);
                console.log(result);
            }
           });
        }

        function cambioPassword(){
            emptyForms();
            $("#form_cambia_password_utente").show();
        }

        function seeUtente(codiceFiscale, nominativo, indirizzo, telefono, email, natoIl, ruolo){
            emptyForms();
            $(".hidden_form").show();
            $(".submit").hide();   //hide submit and show with modificaclick() con cui si riabilitano tutti gli input text
            $('.container input[type="text"]').prop('disabled', true);
            $("#form_utente").show();
            $("#codicefiscale_utente").val(codiceFiscale);
            $("#nominativo_utente").val(nominativo);
            $("#indirizzo_utente").val(indirizzo);
            $("#telefono_utente").val(telefono);
            $("#email_utente").val(email);
            $("#natoil_utente").val(convertDate(natoIl));
        }

        function seeCliente(idCliente, ragioneSociale, nominativo, indirizzo, telefono, email, sito, segnalatore, attivita, interessatoA, registratoDa, data, note){
            emptyForms();
            $(".hidden_form").show();
            $(".submit").hide();   //hide submit and show with modificaclick() con cui si riabilitano tutti gli input text
            $('.container input[type="text"]').prop('disabled', true);
            $("#form_cliente").show();
            $("#idcliente_cliente").val(idCliente);
            $("#ragionesociale_cliente").val(ragioneSociale);
            $("#nominativo_cliente").val(nominativo);
            $("#indirizzo_cliente").val(indirizzo);
            $("#telefono_cliente").val(telefono);
            $("#email_cliente").val(email);
            $("#sito_cliente").val(sito);
            $("#segnalatore_cliente").val(segnalatore);
            $("#attivita_cliente").val(attivita);
            $("#interessatoa_cliente").val(interessatoA);
            $("#registratoda_cliente").val(registratoDa);
            $("#data_cliente").val(convertDate(data));
            $("#note_cliente").val(note);
        }


        function seePratica(idPratica, descrizione, note, data, fkCliente, registratoDa){
            emptyForms();
            $(".hidden_form").show();
            $(".submit").hide();   //hide submit and show with modificaclick() con cui si riabilitano tutti gli input text
            $('.container input[type="text"]').prop('disabled', true);
            $("#form_pratica").show();
            $("#idpratica_pratica").val(idPratica);
            $("#descrizione_pratica").val(descrizione);
            $("#note_pratica").val(note);
            $("#data_pratica").val(convertDate(data));
            $("#fkcliente_pratica").text(fkCliente);
            $("#registratoda_pratica").val(registratoDa);
        }

        function seeDocumento(idDocumento, descrizione, percorsoFile, note, stepPratica, fkPratica, registratoDa, data){
            console.log("IDDOCUMENTO: " + idDocumento);
            emptyForms();
            $(".hidden_form").show();
            $(".submit").hide();   //hide submit and show with modificaclick() con cui si riabilitano tutti gli input text
            $('.container input[type="text"]').prop('disabled', true);
            $("#form_documento").show();
            $("#iddocumento_documento").text(idDocumento);
            $("#descrizione_documento").val(descrizione);
            $("#note_documento").val(note);
            $("#percorsofile_documento").text(percorsoFile);
            $("#download_documento").prop('href', '/getfile?filename=' + percorsoFile);
            $("#stepPraticaDocumentoSelect").val(stepPratica);
            $("#file_upload_step").val(stepPratica);
            $("#fkpratica_documento").text(fkPratica);
            $("#registratoda_documento").val(registratoDa);
            $("#data_documento").val(convertDate(data));
        }

        function modificaClick(caller){
            $(".submit").show();
            $(".modifica").hide();
            $('.container input[type="text"]').prop('disabled', false);
            if(caller == 'utente'){
                updatingId = $("#codicefiscale_utente").val();
            }else if(caller == 'cliente'){
                updatingId = $("#idcliente_cliente").val();
            }else if(caller == 'pratica'){
                updatingId = $("#idpratica_pratica").val();
            }
        }


        function submitUtente(){
            //raccolta dati e chiamata AJAX
            $.ajax({
               url: '/update/utente',
               type: "POST",
               data: {
                 oldId:         updatingId,
                 codiceFiscale: $("#codicefiscale_utente").val(),
                 nominativo:    $("#nominativo_utente").val(),
                 indirizzo:     $("#indirizzo_utente").val(),
                 telefono:      $("#telefono_utente").val(),
                 email:         $("#email_utente").val(),
                 natoIl:        $("#natoil_utente").val(),
                 password:      '1234'
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  emptyForms();
                  $("#form_utente").hide();
                  showUtenti();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
           });
        }

        function submitPasswordUtente(){
            //raccolta dati e chiamata AJAX
            var vecchiaPassword = $("#vecchia_password_utente").val();
            var nuovaPassword = $("#cambiapwd_password_utente").val();
            var confermaPassword = $("#cambiapwd_confermapassword_utente").val();
            if(nuovaPassword == confermaPassword){
                $.ajax({
               url: '/password',
               type: "POST",
               data: {
                 vecchiapassword: $("#vecchia_password_utente").val(),
                 nuovapassword:   $("#cambiapwd_password_utente").val()
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  showUtenti();
                  alert("La tua password e' stata modificata con successo.");
                  $("#vecchia_password_utente").val('');
                  $("#cambiapwd_password_utente").val('');
                  $("#cambiapwd_confermapassword_utente").val('');
                  $("#form_cambia_password_utente").hide();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
           });
            } else {
                alert("Le due password non coincidono!");
            }

        }

        function submitCliente(){
            //raccolta dati e chiamata AJAX
            $.ajax({
               url: '/update/cliente',
               type: "POST",
               data: {
                 oldId:             updatingId,
                 idCliente:         $("#idcliente_cliente").val(),
                 ragioneSociale:    $("#ragionesociale_cliente").val(),
                 nominativo:        $("#nominativo_cliente").val(),
                 indirizzo:         $("#indirizzo_cliente").val(),
                 telefono:          $("#telefono_cliente").val(),
                 email:             $("#email_cliente").val(),
                 sito:              $("#sito_cliente").val(),
                 segnalatore:       $("#segnalatore_cliente").val(),
                 attivita:          $("#attivita_cliente").val(),
                 interessatoA:      $("#interessatoa_cliente").val(),
                 note:              $("#note_cliente").val()
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  alert("Aggiornamento contatti avvenuto con successo!");
                  resetFormsAndTables();
                  clientiTabClick();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
           });

        }

        function submitPratica(){
            //raccolta dati e chiamata AJAX
            $.ajax({
               url: '/update/pratica',
               type: "POST",
               data: {
                 oldId:             updatingId,
                 idPratica:         $("#idpratica_pratica").val(),
                 note:              $("#note_pratica").val(),
                 descrizione:       $("#descrizione_pratica").val(),
                 fkCliente:         $("#fkcliente_pratica").text()
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  alert("Aggiornamento pratiche avvenuto con successo!");
                  resetFormsAndTables();
                  clientiTabClick();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
            });
        }

        function submitDocumento(){
            //raccolta dati e chiamata AJAX
            $.ajax({
               url: '/update/documento',
               type: "POST",
               data: {
                 idDocumento:       $("#iddocumento_documento").text(),
                 descrizione:       $("#descrizione_documento").val(),
                 percorsoFile:      $("#percorsofile_documento").text(),
                 note:              $("#note_documento").val(),
                 stepPratica:       $("#stepPraticaDocumentoSelect").val(),
                 fkPratica:         $("#fkpratica_documento").text(),
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  alert("Aggiornamento pratiche avvenuto con successo!");
                  resetFormsAndTables();
                  clientiTabClick();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
            });
        }

        function submitScadenza(){
            //raccolta dati e chiamata AJAX
            $.ajax({
               url: '/save/scadenza',
               type: "POST",
               data: {
                 descrizione:       $("#descrizione_scadenza").val(),
                 dataScadenza:      $("#datascadenza_scadenza").val(),
                 fkCliente:         $("#fkcliente_scadenza").text(),
                 avvisoDa:          $("#avvisoDaSelect").val()
               },
               success: function (data, status, xhr) {
                  console.log(data);
                  alert("Scadenza inserita con successo!");
                  chiudiModalNuovaScadenza();
                  resetFormsAndTables();
                  clientiTabClick();
               },
               error: function(result) {
                  alert("Errore: " + result.responseJSON.message);
                  console.log(result);
               }
            });
        }


        function nuovoUtente(){
            emptyForms();
            $("#form_utente").show();
            alert("ATTENZIONE: quando un nuovo utente del sistema e' generato, viene impostata la password di base 1234");
        }
        function nuovoCliente(){
            emptyForms();
            $("#form_cliente").show();
        }
        function nuovaPratica(){
            emptyForms();
            $("#form_pratica").show();
            $("#fkcliente_pratica").text(fkcliente);
            console.log("FKCLIENTE: " + fkcliente);
        }
        function nuovoDocumento(){
            emptyForms();
            $("#form_documento").show();
            $("#fkpratica_documento").text(fkpratica);
            console.log("FKPRATICA: " + fkpratica);
        }

        function nuovaScadenza(fkCliente){      //apre il modal per inserire la nuova scadenza
            $(".always_enabled").prop("disabled", false);
            $("#fkcliente_scadenza").text(fkCliente);
            $("#modal_nuova_scadenza").addClass("is-active");
        }

        function chiudiModalNuovaScadenza(){    //chiude il modal per inserire la nuova scadenza
            $("#fkcliente_scadenza").text('');
            $("#modal_nuova_scadenza").removeClass("is-active");
        }

        function resetFormsAndTables(){
            $("#home_div").hide();
            $("#contatti_div").hide();
            $("#tabella_utenti").hide();
            $("#tabella_scadenze").hide();
            $("#tabella_clienti").hide();
            $("#tabella_pratiche").hide();
            $("#tabella_documenti").hide();
            $("#form_utente").hide();
            $("#form_cliente").hide();
            $("#form_cambia_password_utente").hide();
            $("#form_pratica").hide();
            $("#form_documento").hide();
            $(".tab").removeClass("is-active");
            $("#body_tabella_utenti").empty();
            $("#body_tabella_scadenze").empty();
            $("#body_tabella_clienti").empty();
            $("#body_tabella_pratiche").empty();
            $("#body_tabella_documenti").empty();
            $("#cercaClientiInput").val('');
            $('.container input[type="text"]').val('');
            $('.container input[type="password"]').val('');
            $('.container label').text('');
            $(".hidden_form").hide();
            $('.container input[type="text"]').prop('disabled', false);
            $(".submit").show();
            updatingId='';
            fkcliente='';
            fkpratica='';
            $("#file_upload_cliente").val('');
            $("#file_upload_pratica").val('');
            $("#file_upload_step").val('');
            $("#file_upload_documento").val('');
            $('.container input[type="file"]').val('');
            //$(".navbar-menu").removeClass("is-active");
            //$(".navbar-burger").removeClass("is-active")
        }
        
        function emptyForms(){
            $("#form_utente").hide();
            $("#form_cliente").hide();
            $("#form_cambia_password_utente").hide();
            $("#form_pratica").hide();
            $("#form_documento").hide();
            $('.container input[type="text"]').val('');
            $('.container input[type="password"]').val('');
            $('.container label').text('');
            $('.container input[type="text"]').prop('disabled', false);
            $(".hidden_form").hide();
            $(".submit").show();
            updatingId='';
            $('.container input[type="file"]').val('');
            //$(".navbar-menu").removeClass("is-active");
            //$(".navbar-burger").removeClass("is-active")
        }

        
        function homeTabClick(){
            resetFormsAndTables();
            $("#home_tab").addClass("is-active");
            $("#home_div").show();
        }
        function utentiTabClick(){
            resetFormsAndTables();
            $("#utenti_tab").addClass("is-active");
            showUtenti();
            $("#tabella_utenti").show();
        }
        function scadenzeTabClick(){
            resetFormsAndTables();
            $("#scadenze_tab").addClass("is-active");
            showScadenze();
            $("#tabella_scadenze").show();
        }
        function clientiTabClick(){
            resetFormsAndTables();
            $("#clienti_tab").addClass("is-active");
            $("#tabella_clienti").show();
        }
        function contattiTabClick(){
            resetFormsAndTables();
            $("#contatti_tab").addClass("is-active");
            $("#contatti_div").show();
        }
        function convertDate(inputFormat) {
            function pad(s) { return (s < 10) ? '0' + s : s; }
            var d = new Date(inputFormat);
            return [pad(d.getDate()), pad(d.getMonth()+1), d.getFullYear()].join('/');
        }
        function logoutClick(){
            resetFormsAndTables();
            $.ajax({
                url: '/logout',
                type: "GET",
                success: function (data, status, xhr) {
                  console.log(data);
                  location.reload();
                },
                error: function(result) {
                  alert("Errore: " + result.responseJSON.error);
                  console.log(result);
                }
           });
        }

        //per il "burger menu' visibile nei dispositivi mobili"
        /*document.addEventListener('DOMContentLoaded', function () {
            var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
            if ($navbarBurgers.length > 0) {
                $navbarBurgers.forEach(function ($el) {
                    $el.addEventListener('click', function () {
                        var target = $el.dataset.target;
                        var $target = document.getElementById(target);
                        $el.classList.toggle('is-active');
                        $target.classList.toggle('is-active');
                    });
                });
            }
        });*/

        // eventualmente: ---- nella ricerca per segnalatore rendere possibile l'inversione del nome e del cognome
        // inserire un piccolo sistema di log
        // inserire le dipendenze per mysql
        // vedere se è possibile utilizzare un form di login custom, anche a costo di usare un altro controller
        // dopo un inserimento corretto provare a non chiudere tutti i tab
        // spostare il javascript in un file dedicato



    </script>

</body>
</html>