<!DOCTYPE html>
<html>
<head>
    <title>Gestic</title>
    <link rel="icon" href="https://cdn2.iconfinder.com/data/icons/web/512/Global_Connections-512.png">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.0/css/bulma.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        input[type='text']{height:35px; width:500px;}
        input[type='password']{height:35px; width:300px;}
    </style>
</head>

<body style="margin:20px;padding-top:20px;" class="container">

<a class="button is-outlined is-info" onclick="logoutClick()" style="float: right">Esci</a>

<div id="tabs_processi" class="tabs">
    <ul>
        <li id="home_tab"     class="tab is-active"><a  onclick="homeTabClick()">Home</a></li>
        <li id="utenti_tab"   class="tab"><a onclick="utentiTabClick()">Utenti</a></li>
        <li id="clienti_tab"  class="tab"><a onclick="clientiTabClick()">Anagrafica</a></li>
        <li id="contatti_tab" class="tab"><a onclick="contattiTabClick()">Contatti</a></li>
    </ul>
</div>


<div class="box has-text-centered" id="home_div">
    <h3 class="title"><b>Gestic</b></h3>
    <h3 class="subtitle"><b>il gestionale di</b></h3>
    <img src="../img/logo_impresa_consulting.png" />
</div>

<div class="box has-text-centered" id="contatti_div">
    <p> <b>NUOVA SEDE: </b></p><br />

    <p>    VIA SALVO D'ACQUISTO 3 </p>
    <p>    70014 CONVERSANO (BA)  </p>
    <p>    CONTATTI:  080.8490902 </p>
    <p>    EMAIL: <b>   <a href="mailto:info@icnews.it" target="_top">info@icnews.it</a></b></p>

    <p>
        <a class='fa fa-facebook fa-2x has-text-info' target="_blank" href="https://www.facebook.com/impresaconsulting/"></a>
        SEGUICI SU FACEBOOK PER NEWS!
    </p>


</div>


<div class="box has-text-centered" id="tabella_utenti">
    <h3 class="subtitle"><b>Utenti</b></h3>

    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>CODICE FISCALE</th>
                <td>NOMINATIVO</td>
                <td>EMAIL</td>
                <td>RUOLO</td>
            </tr>
        </thead>
        <tbody id="body_tabella_utenti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
</div>

<div class="box has-text-centered" id="tabella_clienti">

    <div class="field has-addons">
        <p style="padding-top:5px;"> Cerca in anagrafica per: &nbsp &nbsp &nbsp</p>
        <select id="cercaClientiSelect" style="height:35px;">
            <option value="nominativo">Nominativo</option>
            <option value="ragionesociale">Ragione sociale</option>
            <option value="attivita">Attivita'</option>
            <option value="segnalatore">Segnalatore</option>
            <option value="interessatoa">Interessato a</option>
            <option value="tutti">Visualizza tutti</option>
        </select>
        <div class="control">
            <input id="cercaClientiInput" class="input" type="text" placeholder="Parametro di ricerca">
        </div>
        <div class="control">
            <a id="cercaClientiButton" class="button is-info" onclick="cercaClienti()">Cerca</a>
        </div>
    </div><br /><br />

    <h3 class="subtitle"><b>Anagrafica</b></h3>
    <table class="table is-striped has-text-centered" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>P.IVA/C.F.</th>
                <td>RAGIONE SOCIALE</td>
                <td>NOMINATIVO</td>
                <td>ATTIVITA'</td>
                <td>PRATICHE</td>
            </tr>
        </thead>
        <tbody id="body_tabella_clienti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
                <td></td>
                <td><td>
            </tr>
        </tbody>
    </table>
    <br /><br />
</div>

<div class="box has-text-centered" id="tabella_pratiche">
    <h3 class="subtitle"><b>Pratiche</b></h3>
    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
            <tr>
                <th>DESCRIZIONE</th>
                <td>DATA</td>
                <td>DOCUMENTI</td>
            </tr>
        </thead>
        <tbody id="body_tabella_pratiche">
            <tr>
                <th></th>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
</div>

<div class="box has-text-centered" id="tabella_documenti">
    <h3 class="subtitle"><b>Documenti</b></h3>
    <table class="table is-striped" style="margin: 0px auto;">
        <thead>
        <tr>
            <th>DESCRIZIONE</th>
            <td>STEP</td>
            <td>DATA</td>
        </tr>
        </thead>
        <tbody id="body_tabella_documenti">
            <tr>
                <th></th>
                <td></td>
                <td></td>
            </tr>
        </tbody>
    </table>
    <br /><br />
</div>

<!--  ************************************************************* -->
<div class="box" id="form_utente">
    <h3 class="subtitle has-text-centered"><b>Form nuovo utente</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Codice Fiscale: </b></span><input type="text" id="codicefiscale_utente" placeholder="Codice Fiscale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Nominativo: </b></span><input type="text" id="nominativo_utente" placeholder="Nominativo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Indirizzo: </b></span><input type="text" id="indirizzo_utente" placeholder="Indirizzo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Telefono: </b></span><input type="text" id="telefono_utente" placeholder="Telefono"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>E-mail: </b></span><input type="text" id="email_utente" placeholder="E-mail"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Data di nascita: </b></span><input type="text" id="natoil_utente" placeholder="Data di nascita"><br />
    <span style="display: inline-block;width:400px;padding-top:15px;"><b>Password: </b></span><input type="password" id="password_utente" placeholder="Password"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Conferma password: </b></span><input type="password" id="confermapassword_utente" placeholder="Conferma password"><br />
    <br /><a class="button is-primary is-medium" onclick="">Submit</a>
</div>

<div class="box" id="form_cambia_password_utente">
    <h3 class="subtitle  has-text-centered"><b>Form cambia password</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Password: </b></span><input type="password" id="cambiapwd_password_utente" placeholder="Password"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Conferma password: </b></span><input type="password" id="cambiapwd_confermapassword_utente" placeholder="Conferma password"><br />
    <br /><a class="button is-primary is-medium" onclick="">Submit</a>
</div>

<div class="box" id="form_cliente">
    <h3 class="subtitle has-text-centered"><b>Form nuovo cliente / modifica cliente</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>P.Iva / Codice Fiscale: </b></span><input type="text" id="idcliente_cliente" placeholder="P. Iva / Codice Fiscale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Ragione sociale: </b></span><input type="text" id="ragionesociale_cliente" placeholder="Ragione sociale"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Nominativo: </b></span><input type="text" id="nominativo_cliente" placeholder="Nominativo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Indirizzo: </b></span><input type="text" id="indirizzo_cliente" placeholder="Indirizzo"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Telefono: </b></span><input type="text" id="telefono_cliente" placeholder="Telefono"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>E-mail: </b></span><input type="text" id="email_cliente" placeholder="E-mail"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Sito: </b></span><input type="text" id="sito_cliente" placeholder="Sito"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Segnalatore: </b></span><input type="text" id="segnalatore_cliente" placeholder="Segnalatore"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Attivita': </b></span><input type="text" id="attivita_cliente" placeholder="Attivita"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Interessato a: </b></span><input type="text" id="interessatoa_cliente" placeholder="Interessato a..."><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_cliente" placeholder="Note"><br />
    <!-- registrato da e data sono visualizzati dall'elenco e non dal form-->
    <br /><a class="button is-primary is-medium" onclick="">Submit</a>
</div>

<div class="box" id="form_pratica">
    <h3 id="title_form_pratica" class="subtitle  has-text-centered"><b>Form nuova pratica / modifica pratica</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>ID Pratica: </b></span><input type="text" id="id_pratica" placeholder="Id pratica"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Descrizione: </b></span><input type="text" id="descrizione_pratica" placeholder="Descrizione"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_pratica" placeholder="Note"><br />
    <!-- id, fkcliente, registrato da e data sono visualizzati dall'elenco e non dal form-->
    <br /><a class="button is-primary is-medium" onclick="">Submit</a>
</div>

<div class="box" id="form_documento">
    <h3 class="subtitle has-text-centered"><b>Form nuovo documento / modifica documento</b></h3>
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Descrizione: </b></span><input type="text" id="descrizione_documento" placeholder="Descrizione"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><a class="button is-info is-outlined" onclick="">Carica</a></span><input type="text" enabled="disabled" id="percorsofile_documento" value="/users/files/mydocument.pdf"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Note: </b></span><input type="text" id="note_documento" placeholder="Note"><br />
    <span style="display: inline-block;width:400px;padding-top:5px;"><b>Step pratica: </b></span>
    <select id="stepPraticaDocumentoSelect" style="height:35px;">
        <option value="presentazione">Presentazione</option>
        <option value="ammissione">Ammissione</option>
        <option value="rendicontazione">Rendicontazione</option>
        <option value="collaudo">Collaudo</option>
    </select><br />
    <!-- id, fkcliente, registrato da e data sono visualizzati dall'elenco e non dal form-->
    <br /><a class="button is-primary is-medium" onclick="">Submit</a>
</div>

<script>
        $(document).ready(function(){
          homeTabClick();
        });

        function showUtenti(){
           $.ajax({
            url: '/get/utente',
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_utenti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_utenti").append("<tr><th>" + val.codiceFiscale + "</th><td>" + val.nominativo + "</td><td>" + val.email + "</td><td>" + val.ruolo + "</td></tr>");
                });
            },
            error: function(result) {
                alert("Error!");
                console.log(result);
            }
           });
        }


        function cercaClienti(){
            var parametroRicerca = $("#cercaClientiInput").val();
            var tipoRicerca = $("#cercaClientiSelect").val();
            var urlComposto = '/get/cliente';

            if(tipoRicerca == 'nominativo'){
                urlComposto = '/get/cliente/nominativo/' + parametroRicerca;
            }else if(tipoRicerca == 'ragionesociale'){
                urlComposto = '/get/cliente/ragionesociale/' + parametroRicerca;
            }else if(tipoRicerca == 'attivita'){
                urlComposto = '/get/cliente/attivita/' + parametroRicerca;
            }else if(tipoRicerca == 'segnalatore'){
                urlComposto = '/get/cliente/segnalatore/' + parametroRicerca;
            }else if(tipoRicerca == 'interessatoa'){
                urlComposto = '/get/cliente/interessatoa/' + parametroRicerca;
            }

            showClienti(urlComposto);
        }


        function showClienti(urlComposto){
           $.ajax({
            url: urlComposto, //'/get/cliente',
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_clienti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_clienti").append("<tr id='istanza_cliente_" + val.idCliente + "' class='generic_cliente'><th>" + val.idCliente + "</th><td>" + val.ragioneSociale + "</td><td>" + val.nominativo + "</td><td>" + val.attivita + "</td><td style='text-align: center;'><i class='fa fa-folder fa-2x has-text-info' onclick='showPratiche(\"" + val.idCliente + "\")'></i></td></tr>");
                });
            },
            error: function(result) {
                alert("Error!");
                console.log(result);
            }
           });
        }

        function showPratiche(idCliente){
           $("#istanza_cliente_" + idCliente).removeClass("generic_cliente");
           $(".generic_cliente").empty();
           $("#tabella_pratiche").show();
           $.ajax({
            url: '/get/pratica/cliente/' + idCliente,
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_pratiche").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_pratiche").append("<tr id='istanza_pratica_" + i + "' class='generic_pratica'><th onclick='seePratica(" + val + ")'>" + val.descrizione + "</th><td>" + convertDate(val.data) + "</td><td style='text-align: center;'><i class='fa fa-folder fa-2x has-text-success' onclick='showDocumenti(\"" + val.idPratica + "\", \"" + i + "\")'> </i></td></tr>");
                });
            },
            error: function(result) {
                alert("Errore: " + result);
                console.log(result);
            }
           });
        }

        function showDocumenti(idPratica, i){
           $("#istanza_pratica_" + i).removeClass("generic_pratica");
           $(".generic_pratica").empty();

           $("#tabella_documenti").show();

           $.ajax({
            url: '/get/documento/pratica/' + idPratica,  //controllare se giusto
            type: "GET",
            success: function (data, status, xhr) {
                console.log(data);
                $("#body_tabella_documenti").empty();
                jQuery.each(data, function(i, val) {
                    $("#body_tabella_documenti").append("<tr><th onclick='seeDocumento(" + val + ")'>" + val.descrizione + "</th><td>" + val.stepPratica + "</td><td>" + convertDate(val.data) + "</td></tr>");
                });
            },
            error: function(result) {
                alert("Error!");
                console.log(result);
            }
           });
        }

        function seePratica(pratica){
            emptyForms();
            $("#title_form_pratica").val("Pratica cliente: " + pratica.fkCliente);
            $("#descrizione_pratica").val(pratica.descrizione);
            $("#note_pratica").val(pratica.note);
        }

        function seeDocumento(documento){
            emptyForms();
            $("#title_form_documento").val("Documento pratica: " + documento.fkPratica);
            $("#descrizione_documento").val(documento.descrizione);
            $("#note_documento").val(documento.note);
            $("#percorsofile_documento").val(documento.percorsofile);
        }

        function emptyForms(){

            $("#home_div").hide();
            $("#contatti_div").hide();
            $("#tabella_utenti").hide();
            $("#tabella_clienti").hide();
            $("#tabella_pratiche").hide();
            $("#tabella_documenti").hide();

            $("#form_utente").hide();
            $("#form_cliente").hide();
            $("#form_cambia_password_utente").hide();
            $("#form_pratica").hide();
            $("#form_documento").hide();

            $(".tab").removeClass("is-active");
            $("#body_tabella_utenti").empty();
            $("#body_tabella_clienti").empty();
            $("#body_tabella_pratiche").empty();
            $("#body_tabella_documenti").empty();
            $("#cercaClientiInput").val('');
            $('.container input[type="text"]').val('');
            $('.container input[type="password"]').val('');
        }


        function homeTabClick(){
            emptyForms();
            $("#home_tab").addClass("is-active");
            $("#home_div").show();
        }
        function utentiTabClick(){
            emptyForms();
            $("#utenti_tab").addClass("is-active");

            showUtenti();

            $("#tabella_utenti").show();
            $("#form_cambia_password_utente").show();   //TODO: da rimuovere
            $("#form_utente").show();                   //TODO: da rimuovere

        }
        function clientiTabClick(){
            emptyForms();
            $("#clienti_tab").addClass("is-active");
            $("#tabella_clienti").show();
            $("#form_cliente").show();
            $("#form_pratica").show();
            $("#form_documento").show();
        }
        function contattiTabClick(){
            emptyForms();
            $("#contatti_tab").addClass("is-active");
            $("#contatti_div").show();
        }
        function convertDate(inputFormat) {
            function pad(s) { return (s < 10) ? '0' + s : s; }
            var d = new Date(inputFormat);
            return [pad(d.getDate()), pad(d.getMonth()+1), d.getFullYear()].join('/');
        }

        function logoutClick(){
            emptyForms();
            $.ajax({
                url: '/logout',
                type: "GET",
                success: function (data, status, xhr) {
                  console.log(data);
                  location.reload();
                },
                error: function(result) {
                  alert("Error!");
                  console.log(result);
                }
           });
        }

        //al click su un ID di elemento di tabella deve visualizzare il form compilato e disabilitato.
        //in corrispondenza del form ci deve essere un pulsantino che modifichi i dati per risalvarli

        // v----------- togliere elimina dalle tabelle
        // v----------- togliere fk dalle tabelle visualizzate
        // v----------- sostituire il termine "Clienti" con "Anagrafica"
        // v----------- togliere registratoDa dalla visualizzazione tabelle
        // v----------- cercare nell'anagrafica per RAG.SOC, NOMINATIVO, ATTIVITA', SEGNALATORE (nominativo), INTERESSATOA tramite tendina
        // nella ricerca per segnalatore rendere possibile l'inversione del nome e del cognome
        // valutare se inserire una descrizione breve da visualizzare in tabella ed una lunga
        // v----------- la pratica ha un ID da inserire manualmente e non è autogenerato
        // v----------- quando inserisco un documento devo (tramite tendina) selezionare lo step della pratica
        // v----------- aggiungere lo step pratica nel file Documento.class
        // quando carico un documento devo creare le cartelle dove salvarlo idcliente/idpratica/presentazione||ammissione||rendicontazione||collaudo
        // scadenziario: id, descrizione, scadenza, registratoda, fkCliente, quando (stesso giorno, giorno prima, 5 gg, 10 gg)







    </script>

</body>
</html>